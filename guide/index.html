<html><head><title>sup: Usage guide</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Jakub Kozłowski" /><meta name="description" content="Functional healthchecks in Scala" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="sup: Usage guide" /><meta name="title" property="og:title" content="sup: Usage guide" /><meta name="og:site_name" content="sup" /><meta name="og:url" content="https://github.com/kubukoz/sup" /><meta name="og:type" content="website" /><meta name="og:description" content="Functional healthchecks in Scala" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="sup: Usage guide" /><meta name="twitter:image" content="https://sup.kubukoz.com/img/poster.png" /><meta name="twitter:description" content="Functional healthchecks in Scala" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:creator" content="@kubukoz" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/default.css" /><link rel="stylesheet" href="/css/style.css" /><link rel="stylesheet" href="/css/palette.css" /><link rel="stylesheet" href="/css/codemirror.css" /><script async="async">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-55943015-9' , 'auto');
ga('send', 'pageview');
      </script></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>sup</span></div></a></li> <li><a href="/guide/" class=" active ">Usage guide</a></li> <li><a href="/guide/scalacache.html" class="">Modules</a> <ul class="sub_section"> <li><a href="/guide/scalacache.html" class="">Scalacache</a></li> <li><a href="/guide/doobie.html" class="">Doobie</a></li> <li><a href="/guide/fs2-redis.html" class="">fs2-redis</a></li> <li><a href="/guide/log4cats.html" class="">log4cats</a></li> <li><a href="/guide/http4s-circe.html" class="">http4s / circe</a></li> <li><a href="/guide/akkahttp.html" class="">akka-http</a></li> <li><a href="/guide/sttp.html" class="">sttp</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/kubukoz/sup"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/kubukoz/sup"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('sup Functional healthchecks in Scala');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('sup Functional healthchecks in Scala');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="kubukoz" data-github-repo="sup"><div class="content-wrapper"><section><h1 id="usage-guide">Usage guide</h1>

<ul>
  <li><a href="#installation">Installation</a></li>
  <li><a href="#core-concepts">Core concepts</a>
    <ul>
      <li><a href="#health">Health</a></li>
      <li><a href="#healthresult">HealthResult</a></li>
      <li><a href="#healthcheck">HealthCheck</a></li>
    </ul>
  </li>
  <li><a href="#advanced-concepts">Advanced concepts</a>
    <ul>
      <li><a href="#healthreporter">HealthReporter</a></li>
      <li><a href="#tagging">Tagging</a></li>
    </ul>
  </li>
  <li><a href="#modifiers">Modifiers</a></li>
</ul>

<h2 id="installation">Installation</h2>

<p>For sbt:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"com.kubukoz"</span> <span class="o">%%</span> <span class="s">"sup-core"</span> <span class="o">%</span> <span class="s">"0.7.0-M2"</span>
</code></pre>
</div>

<p>For ammonite:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import $ivy.`com.kubukoz::sup-core:0.7.0-M2`
</code></pre>
</div>

<p>Imports:</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">sup._</span>
</code></pre>
</div>

<h2 id="core-concepts">Core concepts</h2>

<ul>
  <li><a href="#health">Health</a></li>
  <li><a href="#healthresult">HealthResult</a></li>
  <li><a href="#healthcheck">HealthCheck</a></li>
</ul>

<h3 id="health">Health</h3>

<p><code class="highlighter-rouge">Health</code> is a boolean-like health status. In ADT notation:</p>

<div class="language-haskell highlighter-rouge"><pre class="highlight"><code><span class="kr">data</span> <span class="kt">Health</span> <span class="o">=</span> <span class="kt">Sick</span> <span class="o">|</span> <span class="kt">Healthy</span>
</code></pre>
</div>

<p>It has a commutative monoid, which is equivalent to the “all” monoid for booleans.</p>

<p>That means <code class="highlighter-rouge">Health</code> values can be combined with the following semantics:</p>

<table>
  <thead>
    <tr>
      <th>|+|</th>
      <th><strong>Sick</strong></th>
      <th><strong>Healthy</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Sick</strong></td>
      <td>Sick</td>
      <td>Sick</td>
    </tr>
    <tr>
      <td><strong>Healthy</strong></td>
      <td>Sick</td>
      <td>Healthy</td>
    </tr>
  </tbody>
</table>

<h3 id="healthresult">HealthResult</h3>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="c1">//simplified
</span><span class="k">type</span> <span class="kt">HealthResult</span><span class="o">[</span><span class="kt">H</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="k">=</span> <span class="n">H</span><span class="o">[</span><span class="kt">Health</span><span class="o">]</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">HealthResult</code> is a wrapper over a collection <code class="highlighter-rouge">H</code> of <code class="highlighter-rouge">Health</code>.
There are no limitations about what kind of collection that must be, but it’s recommended
that it has a <code class="highlighter-rouge">cats.Foldable</code> instance. For a single Health, <code class="highlighter-rouge">cats.Id</code> can be used.</p>

<p>Other examples of a suitable type include:</p>

<ul>
  <li><code class="highlighter-rouge">cats.Id</code>: there’s only one result.</li>
  <li><code class="highlighter-rouge">sup.Tagged[String, ?]</code>: there’s only one result, tagged with a String (e.g. the dependency’s name)</li>
  <li><code class="highlighter-rouge">cats.data.NonEmptyList</code>: there are multiple checks</li>
  <li><code class="highlighter-rouge">sup.data.Report[cats.Id, cats.data.NonEmptyList, ?]</code>: there’s one check, and a <code class="highlighter-rouge">NonEmptyList</code> of checks</li>
  <li><code class="highlighter-rouge">sup.data.Report[sup.Tagged[String, ?], NonEmptyList, ?]</code>: there’s one check, and a <code class="highlighter-rouge">NonEmptyList</code> of checks tagged with a <code class="highlighter-rouge">String</code>.</li>
</ul>

<p>(<code class="highlighter-rouge">sup.data.Report[F, G, ?]</code> is equivalent to <code class="highlighter-rouge">cats.data.OneAnd[Nested[F, G, ?], ?]</code>)</p>

<p><code class="highlighter-rouge">HealthResult[H]</code> has a <code class="highlighter-rouge">Monoid</code> for any <code class="highlighter-rouge">H[_]: Applicative</code>, although most of its usages will be transparent to the user.</p>

<h3 id="healthcheck">HealthCheck</h3>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="c1">//simplified
</span><span class="k">trait</span> <span class="nc">HealthCheck</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>, <span class="kt">H</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">check</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">HealthResult</span><span class="o">[</span><span class="kt">H</span><span class="o">]]</span>
<span class="o">}</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">HealthCheck[F, H]</code> is a health-checking action with effects of type <code class="highlighter-rouge">F</code> that’ll result in a collection <code class="highlighter-rouge">H</code> of <code class="highlighter-rouge">Health</code>.</p>

<p>Similarly to <code class="highlighter-rouge">HealthResult</code>, a <code class="highlighter-rouge">HealthCheck[F, H]</code> has a monoid for any <code class="highlighter-rouge">F[_]: Applicative, H[_]: Applicative</code>.
This is really cool, because thanks to this we can combine two similar healhchecks into one that’ll check both
(sequentially or in parallel, depending on the applicative of F - to enforce parallel execution use <code class="highlighter-rouge">HealthCheck.parTupled</code>).</p>

<p>Let’s start with some cats imports (assume they’re available in the rest of the page):</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats._</span><span class="o">,</span> <span class="n">cats</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="k">_</span><span class="o">,</span> <span class="n">cats</span><span class="o">.</span><span class="n">effect</span><span class="o">.</span><span class="k">_</span><span class="o">,</span> <span class="n">cats</span><span class="o">.</span><span class="n">implicits</span><span class="o">.</span><span class="k">_</span>
</code></pre>
</div>

<p>and here’s how healthchecks can be combined:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="c1">//will always be Sick
</span><span class="k">def</span> <span class="n">queue1</span><span class="k">:</span> <span class="kt">HealthCheck</span><span class="o">[</span><span class="kt">IO</span>, <span class="kt">Id</span><span class="o">]</span> <span class="k">=</span> <span class="nc">HealthCheck</span><span class="o">.</span><span class="n">const</span><span class="o">(</span><span class="nc">Health</span><span class="o">.</span><span class="nc">Sick</span><span class="o">)</span>
<span class="c1">// queue1: sup.HealthCheck[cats.effect.IO,cats.Id]
</span>
<span class="c1">//will always be Healthy
</span><span class="k">def</span> <span class="n">queue2</span><span class="k">:</span> <span class="kt">HealthCheck</span><span class="o">[</span><span class="kt">IO</span>, <span class="kt">Id</span><span class="o">]</span> <span class="k">=</span> <span class="nc">HealthCheck</span><span class="o">.</span><span class="n">const</span><span class="o">(</span><span class="nc">Health</span><span class="o">.</span><span class="nc">Healthy</span><span class="o">)</span>
<span class="c1">// queue2: sup.HealthCheck[cats.effect.IO,cats.Id]
</span>
<span class="c1">//will always be Sick
</span><span class="k">def</span> <span class="n">queues</span> <span class="k">=</span> <span class="n">queue1</span> <span class="o">|+|</span> <span class="n">queue2</span>
<span class="c1">// queues: sup.HealthCheck[cats.effect.IO,cats.Id]
</span></code></pre>
</div>

<h2 id="advanced-concepts">Advanced concepts</h2>

<p>In sup, a single dependency’s healthcheck has the same underlying structure as a whole service’s healthcheck
consisting of multiple dependencies’ checks.</p>

<h3 id="healthreporter">HealthReporter</h3>

<p>A healthcheck wrapping multiple healthchecks is called a <code class="highlighter-rouge">HealthReporter</code>. Here’s how it’s defined in sup:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">sup.data.Report</span>

<span class="k">type</span> <span class="kt">HealthReporter</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>, <span class="kt">G</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>, <span class="kt">H</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">HealthCheck</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">Report</span><span class="o">[</span><span class="kt">G</span>, <span class="kt">H</span>, <span class="kt">?</span><span class="o">]]</span>
</code></pre>
</div>

<p>You can construct one from a sequence of healthchecks using the <code class="highlighter-rouge">HealthReporter.fromChecks</code> function:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">kafka</span><span class="k">:</span> <span class="kt">HealthCheck</span><span class="o">[</span><span class="kt">IO</span>, <span class="kt">Id</span><span class="o">]</span> <span class="k">=</span> <span class="nc">HealthCheck</span><span class="o">.</span><span class="n">const</span><span class="o">(</span><span class="nc">Health</span><span class="o">.</span><span class="nc">Healthy</span><span class="o">)</span>
<span class="c1">// kafka: sup.HealthCheck[cats.effect.IO,cats.Id] = sup.HealthCheck$$anon$1@5e8835d5
</span>
<span class="k">val</span> <span class="n">postgres</span><span class="k">:</span> <span class="kt">HealthCheck</span><span class="o">[</span><span class="kt">IO</span>, <span class="kt">Id</span><span class="o">]</span> <span class="k">=</span> <span class="nc">HealthCheck</span><span class="o">.</span><span class="n">const</span><span class="o">(</span><span class="nc">Health</span><span class="o">.</span><span class="nc">Healthy</span><span class="o">)</span>
<span class="c1">// postgres: sup.HealthCheck[cats.effect.IO,cats.Id] = sup.HealthCheck$$anon$1@b0a3e40
</span>
<span class="k">val</span> <span class="n">reporter</span><span class="k">:</span> <span class="kt">HealthReporter</span><span class="o">[</span><span class="kt">IO</span>, <span class="kt">NonEmptyList</span>, <span class="kt">Id</span><span class="o">]</span> <span class="k">=</span> <span class="nc">HealthReporter</span><span class="o">.</span><span class="n">fromChecks</span><span class="o">(</span><span class="n">kafka</span><span class="o">,</span> <span class="n">postgres</span><span class="o">)</span>
<span class="c1">// reporter: sup.HealthReporter[cats.effect.IO,cats.data.NonEmptyList,cats.Id] = sup.HealthCheck$$anon$1@55b91019
</span></code></pre>
</div>

<h3 id="tagging">Tagging</h3>

<p>A healthcheck can be tagged with a label, e.g. a <code class="highlighter-rouge">String</code> with the dependency’s name:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">sup.mods._</span>
<span class="c1">// import sup.mods._
</span>
<span class="k">val</span> <span class="n">kafkaTagged</span> <span class="k">=</span> <span class="n">kafka</span><span class="o">.</span><span class="n">through</span><span class="o">(</span><span class="n">mods</span><span class="o">.</span><span class="n">tagWith</span><span class="o">(</span><span class="s">"kafka"</span><span class="o">))</span>
<span class="c1">// kafkaTagged: sup.HealthCheck[cats.effect.IO,[H]sup.data.Tagged[String,H]] = sup.HealthCheck$$anon$1@21c0d7d3
</span>
<span class="k">val</span> <span class="n">postgresTagged</span> <span class="k">=</span> <span class="n">postgres</span><span class="o">.</span><span class="n">through</span><span class="o">(</span><span class="n">mods</span><span class="o">.</span><span class="n">tagWith</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">))</span>
<span class="c1">// postgresTagged: sup.HealthCheck[cats.effect.IO,[H]sup.data.Tagged[String,H]] = sup.HealthCheck$$anon$1@6ba6d2c9
</span>
<span class="k">val</span> <span class="n">taggedReporter</span> <span class="k">=</span> <span class="nc">HealthReporter</span><span class="o">.</span><span class="n">fromChecks</span><span class="o">(</span><span class="n">kafkaTagged</span><span class="o">,</span> <span class="n">postgresTagged</span><span class="o">)</span>
<span class="c1">// taggedReporter: sup.HealthReporter[cats.effect.IO,cats.data.NonEmptyList,[H]sup.data.Tagged[String,H]] = sup.HealthCheck$$anon$1@6225808c
</span></code></pre>
</div>

<h2 id="modifiers">Modifiers</h2>

<p>sup provides a variety of ways to customize a healthcheck. These include <code class="highlighter-rouge">through</code>, <code class="highlighter-rouge">mapK</code>, <code class="highlighter-rouge">transform</code>, <code class="highlighter-rouge">mapResult</code> and <code class="highlighter-rouge">leftMapK</code>.
Check out the predefined modifiers in the <code class="highlighter-rouge">sup.mods</code> object or create your own.</p>

<p>Here are some example modifiers provided by sup:</p>

<h3 id="timeouttosick"><code class="highlighter-rouge">timeoutToSick</code></h3>

<p>A check modified with <code class="highlighter-rouge">timeoutToSick</code> will be marked as sick if it doesn’t complete within the given duration.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>
<span class="c1">// import scala.concurrent.duration._
</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">contextShift</span><span class="k">:</span> <span class="kt">ContextShift</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">.</span><span class="n">contextShift</span><span class="o">(</span><span class="n">scala</span><span class="o">.</span><span class="n">concurrent</span><span class="o">.</span><span class="nc">ExecutionContext</span><span class="o">.</span><span class="n">global</span><span class="o">)</span>
<span class="c1">// contextShift: cats.effect.ContextShift[cats.effect.IO] = cats.effect.internals.IOContextShift@4bd63a1b
</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">timer</span><span class="k">:</span> <span class="kt">Timer</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">.</span><span class="n">timer</span><span class="o">(</span><span class="n">scala</span><span class="o">.</span><span class="n">concurrent</span><span class="o">.</span><span class="nc">ExecutionContext</span><span class="o">.</span><span class="n">global</span><span class="o">)</span>
<span class="c1">// timer: cats.effect.Timer[cats.effect.IO] = cats.effect.internals.IOTimer@55d31fe2
</span>
<span class="k">val</span> <span class="n">timedKafka</span> <span class="k">=</span> <span class="n">kafka</span><span class="o">.</span><span class="n">through</span><span class="o">(</span><span class="n">mods</span><span class="o">.</span><span class="n">timeoutToSick</span><span class="o">(</span><span class="mf">5.</span><span class="n">seconds</span><span class="o">))</span>
<span class="c1">// timedKafka: sup.HealthCheck[cats.effect.IO,cats.Id] = sup.HealthCheck$$anon$1@44605b94
</span></code></pre>
</div>

<p>Other modifiers with timeouts include <code class="highlighter-rouge">timeoutToDefault</code> and <code class="highlighter-rouge">timeoutToFailure</code>.</p>

<h3 id="tagwith--untag"><code class="highlighter-rouge">tagWith</code> / <code class="highlighter-rouge">untag</code></h3>

<p>Tag a healthcheck with a value (or unwrap a tagged healthcheck):</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">taggedKafka2</span> <span class="k">=</span> <span class="n">kafka</span><span class="o">.</span><span class="n">through</span><span class="o">(</span><span class="n">mods</span><span class="o">.</span><span class="n">tagWith</span><span class="o">(</span><span class="s">"foo"</span><span class="o">))</span>
<span class="c1">// taggedKafka2: sup.HealthCheck[cats.effect.IO,[H]sup.data.Tagged[String,H]] = sup.HealthCheck$$anon$1@73124723
</span>
<span class="k">val</span> <span class="n">untaggedKafka</span> <span class="k">=</span> <span class="n">taggedKafka2</span><span class="o">.</span><span class="n">through</span><span class="o">(</span><span class="n">mods</span><span class="o">.</span><span class="n">untag</span><span class="o">)</span>
<span class="c1">// untaggedKafka: sup.HealthCheck[cats.effect.IO,cats.Id] = sup.HealthCheck$$anon$1@76fbb3da
</span></code></pre>
</div>

<h3 id="recovertosick"><code class="highlighter-rouge">recoverToSick</code></h3>

<p>Swallows any errors that might happen in the healthcheck’s effect and falls back to <code class="highlighter-rouge">Sick</code>.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">safeKafka</span> <span class="k">=</span> <span class="n">kafka</span><span class="o">.</span><span class="n">through</span><span class="o">(</span><span class="n">mods</span><span class="o">.</span><span class="n">recoverToSick</span><span class="o">)</span>
<span class="c1">// safeKafka: sup.HealthCheck[cats.effect.IO,cats.Id] = sup.HealthCheck$$anon$1@3cd2a927
</span></code></pre>
</div>

<h3 id="surround"><code class="highlighter-rouge">surround</code></h3>

<p>Surrounds a healthcheck with effectful actions.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">surroundedKafka</span> <span class="k">=</span> <span class="n">kafka</span><span class="o">.</span><span class="n">through</span><span class="o">(</span><span class="n">mods</span><span class="o">.</span><span class="n">surround</span><span class="o">(</span><span class="nc">IO</span><span class="o">(</span><span class="n">println</span><span class="o">(</span><span class="s">"foo"</span><span class="o">)))(</span><span class="n">result</span> <span class="k">=&gt;</span> <span class="nc">IO</span><span class="o">(</span><span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">"foo result: $result"</span><span class="o">))))</span>
<span class="c1">// surroundedKafka: sup.HealthCheck[cats.effect.IO,cats.Id] = sup.HealthCheck$$anon$1@6441e3cf
</span></code></pre>
</div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script src="/js/main.js"></script></body></html>